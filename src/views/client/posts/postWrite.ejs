<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ê²Œì‹œê¸€ ì‘ì„±</title>
        <link
            rel="stylesheet"
            href="/static/styles/pages/posts/postWrite.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
            integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />

        <!-- <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->
    </head>
    <body>
        <div id="wrap">
            <div class="inner"><%- include('../../_layouts/header-w') %></div>

            <div class="inner container">
                <form id="postWriteForm" class="flex-column-center">
                    <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œì‘ -->
                    <label for="category" class="category">
                        <!-- <span>ì¹´í…Œê³ ë¦¬ ì„ íƒ</span> -->
                        <select
                            name="category"
                            id="category"
                            class="category"
                            required
                        >
                            <option disabled selected>ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                            <% if (post.category.id && post.category.title) { %>
                            <option value="<%= post.category.id %>">
                                <%= post.category.title %>
                            </option>
                            <% } %>
                        </select>
                    </label>
                    <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ë -->

                    <!-- ì œëª© ì…ë ¥ ì‹œì‘ -->
                    <label for="title" class="title">
                        <!-- <span>ì œëª©</span> -->
                        <input
                            type="text"
                            name="title"
                            id="title"
                            required
                            placeholder="ì œëª©ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”."
                        />
                    </label>
                    <!-- ì œëª© ì…ë ¥ ë -->
                    <!-- <div id="summernote"></div> -->

                    <!-- ë‚´ìš© ì…ë ¥ ì‹œì‘ -->

                    <div class="contentArea">
                        <!-- <div id="content" contenteditable="true" placeholder="ê²Œì‹œê¸€ ë‚´ìš©ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”."></div> -->
                        <textarea
                            name="content"
                            id="content"
                            maxlength="2000"
                            placeholder="ê²Œì‹œê¸€ ë‚´ìš©ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”."
                        ></textarea>
                        <div class="upload">
                            <label for="file">
                                <img
                                    src="/static/images/upload-btn-gray.svg"
                                    class="formImg"
                                    alt="íŒŒì¼ì—…ë¡œë“œë²„íŠ¼"
                                />
                            </label>
                            <input type="file" id="file" />
                        </div>
                    </div>

                    <!-- ë‚´ìš© ì…ë ¥ ë -->

                    <!-- ì‘ì„± (ì œì¶œ) ë²„íŠ¼ -->
                    <button type="submit">ì‘ì„± ì™„ë£Œ</button>
                </form>
            </div>
        </div>

        <script>
            const $form = document.getElementById("postWriteForm");

            $form.addEventListener("submit", async (e) => {
                e.preventDefault();
                try {
                    const title = $form.title.value;
                    const content = $form.content.value;

                    // console.log({
                    //   title,
                    //   content,
                    // });

                    const cookies = document.cookie
                        .split(";")
                        .reduce((acc, cookie) => {
                            const [key, value] = cookie.split("=");
                            acc[key.trim()] = decodeURIComponent(value);
                            return acc;
                        }, {});

                    const token = `${cookies.accessToken}`;

                    const res = await fetch("/api/posts", {
                        method: "post",
                        headers: {
                            "Content-Type": "application/json",
                            authorization: token,
                        },
                        body: JSON.stringify({ title, content }),
                    });

                    const data = await res.json();

                    if (!res.ok) {
                        throw new Error(data.details);
                    }

                    location.href = `/posts/${data.postId}`;
                } catch (error) {
                    alert("ê²Œì‹œê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", error.message);
                }
            });

            // ì¹´í…Œê³ ë¦¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const categories = [
                {
                    categoryId: "66f247f68d1dffeca42e1a10",
                    title: "ğŸ‘¨â€ğŸ’» ê°œë°œ ë‚˜ëˆ”ìˆ²",
                },
                {
                    categoryId: "66f24da1aa8f0092f375865a",
                    title: "ğŸ¬ ì˜í™” ë‚˜ëˆ”ìˆ²",
                },
                {
                    categoryId: "66f264b40d793036e28637e8",
                    title: "ğŸœ ë§›ì§‘ ë‚˜ëˆ”ìˆ²",
                },
                {
                    categoryId: "66f28957453960e94559ae7d",
                    title: "ğŸ’­ ì¡ë‹´ ë‚˜ëˆ”ìˆ²",
                },
                {
                    categoryId: "66f28a54453960e94559ae80",
                    title: "ğŸ’ª ìš´ë™ ë‚˜ëˆ”ìˆ²",
                },
            ];

            // select ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            const $category = document.getElementById("category");

            // ì˜µì…˜ ì¶”ê°€ í•˜ê¸°
            categories.forEach((category) => {
                const option = document.createElement("option");
                option.value = category.categoryId; // value ì†ì„±ì— categoryId í• ë‹¹í•´ì£¼ê¸°
                option.textContent = category.title; // í‘œì‹œí•  í…ìŠ¤íŠ¸ì— title í• ë‹¹í•´ì£¼ê¸°
                $category.appendChild(option); // select ìš”ì†Œì— ì˜µì…˜ ì¶”ê°€
            });
        </script>
    </body>
</html>
